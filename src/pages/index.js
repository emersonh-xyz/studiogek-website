import Head from 'next/head'
import React, { useEffect, useState } from 'react'
import { useSession, signOut, signIn } from 'next-auth/react'
import Navbar from '@/components/Navbar';
import PostCard from '@/components/PostCard';
import fetchUserTier from '@/utils/fetch_user_tier';
import fetchCampaignPosts from '@/utils/fetch_campaign_posts'


export default function Home() {

  const [userTier, setUserTier] = useState();
  const [postData, setPostData] = useState([]);

  const { data: session } = useSession();

  // Get all of the posts from the campaign
  const getPosts = async () => {
    const results = await fetchCampaignPosts();
    setPostData(results.data);
  }

  // Get the current tier of the user
  const getTier = async () => {
    const results = await fetchUserTier();
    setUserTier(results);
  }

  console.log(session)

  useEffect(() => {

    // Call our asyncronous functions
    getTier()
    getPosts()



    return () => {
      // this now gets called when the component unmounts
    }


  }, [])


  // Loop over all post data
  const PostItems = () => {
    return (
      postData.map((data) => {
        return <PostCard props={data} />
      })
    )
  }


  return (
    <>
      <Head>
        <title>Patreon</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <header>
        <Navbar tier={userTier} />
      </header>

      <main>
        <div className='h-screen bg-base-200'>
          <section className="">

            {postData &&

              <div className="flex">
                < PostItems />
              </div>
            }

          </section>
        </div >

      </main >

      <footer>

      </footer>

    </>
  )
}
